<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&display=swap" rel="stylesheet">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
        
        <script>
            var SHRM = SHRM || {};
            SHRM.utils = {};

            (function () {
                this.getRemoteData = function (path_to_csv){
                    if (this.ajaxResults[path_to_csv]){
                        return this.ajaxResults[path_to_csv]
                    }else{
                        var ajax = $.get(path_to_csv,function(response){
                            //do nothing
                        });
                        console.log('Fetching new data: ' + path_to_csv)
                        this.ajaxResults[path_to_csv] = ajax
                        return ajax;
                    }
                };

                this.convertCSVtoJSON = function (csv, arrKeys) {
                    let vals = csv.split('\n'), ret = [];
                    
                    for( let i = 1, len = vals.length; i < len; i++ ){
                        if (vals[i].length > 0){
                            let option = vals[i].split(';');
                            if (i == 1){
                                ret.push('{')
                            }else{
                                ret.push(',{')
                            }
                            
                            $.each(arrKeys, function( index, value ) {
                                params=option[index].split('=');
                                if (params.length == 2) {
                                    ret.push( '"' + value + '_keyval": "' + option[index].replace(/(\r\n|\n|\r)/gm,"") + '", "' + value + '": "' + params[1].replace(/(\r\n|\n|\r)/gm,"") + '"');
                                }else{
                                    ret.push( '"' + value + '_keyval": "' + option[index].replace(/(\r\n|\n|\r)/gm,"") + '", "' + value + '": "' + params[0].replace(/(\r\n|\n|\r)/gm,"") + '"');
                                }
                                //ret.push( '"' + value + '": "' + option[index].replace(/(\r\n|\n|\r)/gm,"") + '"');
                                if (arrKeys.length - 1 != index){ ret.push(','); }
                            });
                            ret.push('}')
                        }
                    }
                    //console.log(JSON.parse('[' + ret.join("") + ']'));
                    return JSON.parse('[' + ret.join("") + ']');
                };

                this.getDistinctVals = function (dataObj, key){
                    var lookup = {};
                    var result = [];

                    for (var item, i = 0; item = dataObj[i++];) {
                        var value = eval('item.' + key);

                        if (!(value in lookup)) {
                            lookup[value] = 1;
                            result.push(value);
                        }
                    }

                    return result
                };

                this.configureDropDowns = function (dataObj, key, selectObj, optgroup_label) {
                    result = this.getDistinctVals(dataObj, key)
                    //debugger
                    var $optgroup = selectObj
                    if (optgroup_label){
                        $optgroup = $("<optgroup label='" + optgroup_label + "'>"); 
                    }
                    $.each(result, function (index, value) {
                        params=value.split('=');
                        if (params.length == 2) {
                            $optgroup.append(new Option(params[0], params[1]))
                        }else{
                            $optgroup.append(new Option(value, value))
                        }
                    });
                    if (optgroup_label){
                        selectObj.append($optgroup)
                    }

                    selectObj.prop('data-val', dataObj);
                    $('.selectpicker').selectpicker('refresh');
                };

                this.disableOptions = function (arrOptions, objSelect){
                    var $options = objSelect.find('option');
                    $options.prop('disabled', false);
                    
                    if (arrOptions.length == 0) {
                        objSelect.val('')
                    } else {
                        $options.each(function () {
                            if (( $(this).val() == '' ) || ( $.inArray($(this).val(), arrOptions) >= 0 )){
                                $(this).prop('disabled', false)
                            }else{
                                $(this).prop('disabled', true)
                            }
                        });
                        if(objSelect.find('option:selected').prop('disabled')){
                            objSelect.val('');
                        }
                    }
                    objSelect.trigger('change');

                    if (objSelect.closest('.tab-pane').find('select')[2]){
                        //console.log('Selected: ' + objSelect.closest('.tab-pane').find('select')[0].value + ' -- ' + objSelect.closest('.tab-pane').find('select')[1].value + ' -- ' + objSelect.closest('.tab-pane').find('select')[2].value);
                    }
                    
                };

                this.filterJSON = function (dataObj, criteria){
                    return dataObj.filter(o => Object.keys(criteria).every(k => criteria[k].some(f => o[k] === f)));
                };
                
                this.urlParam = function(key){
                    var params = new RegExp('[\?&]' + key + '=([^&#]*)').exec(window.location.href);
                    if (params==null) {
                        return null;
                    }
                    return decodeURI(params[1]);
                };

                this.resetDrillDownSiblings = function(classname, oSelects){
                    $.each(oSelects, function( index, value ) {
                        //change it to read class vs index
                        if (!($( oSelects[index] ).hasClass(classname))) {
                            $( oSelects[index] ).val('');
                            $( oSelects[index] ).selectpicker('refresh');
                        }
                    });
                };

                this.filterDrillDownSiblings = function(ndx, filterBy, objContainter, arrConfigKeys){
                    var dataObj = objContainter.find('select:nth(' + ndx + ')').prop('data-val');
                    var filteredObj = this.filterJSON(dataObj, filterBy)
                    var arrOptions = this.getDistinctVals(filteredObj, arrConfigKeys[ndx + 1])
                    this.disableOptions(arrOptions, objContainter.find('select:nth(' + (ndx+1) + ')'));
                    $('.selectpicker').selectpicker('refresh');
                };

                this.ajaxResults = {};

                this.globalConfigKeys = [];

                this.capitalize = function(s){
                    if (typeof s !== 'string') return ''
                    return s.charAt(0).toUpperCase() + s.slice(1)
                };

                this.prepHTML2CSV = function(arr, columnCount, initial){
                    /*
                    * Convert data array to CSV string
                    * @param arr {Array} - the actual data
                    * @param columnCount {Number} - the amount to split the data into columns
                    * @param initial {String} - initial string to append to CSV string
                    * return {String} - ready CSV string
                    */

                    var row = ''; // this will hold data
                    var delimeter = ','; // data slice separator, in excel it's `;`, in usual CSv it's `,`
                    var newLine = '\r\n'; // newline separator for CSV row

                    /*
                    * Convert [1,2,3,4] into [[1,2], [3,4]] while count is 2
                    * @param _arr {Array} - the actual array to split
                    * @param _count {Number} - the amount to split
                    * return {Array} - splitted array
                    */
                    function splitArray(_arr, _count) {
                        var splitted = [];
                        var result = [];
                        _arr.forEach(function(item, idx) {
                        if ((idx + 1) % _count === 0) {
                            splitted.push(item);
                            result.push(splitted);
                            splitted = [];
                        } else {
                            splitted.push(item);
                        }
                        });
                        return result;
                    }
                    var plainArr = splitArray(arr, columnCount);
                    // don't know how to explain this, so you'll just have to like follow the code to understand
                    // it converts `['a', 'b', 'c']` to `a,b,c` string
                    plainArr.forEach(function(arrItem) {
                        arrItem.forEach(function(item, idx) {
                        row += item + ((idx + 1) === arrItem.length ? '' : delimeter);
                        });
                        row += newLine;
                    });
                    return initial + row;
                };

            }).apply(SHRM.utils);

            function initDrillDown(objContainter){
                if (objContainter.attr('loaded') === undefined){
                    var arrConfigKeys = SHRM.utils.globalConfigKeys;

                    if (objContainter.attr('data-val-config-keys')){
                        arrConfigKeys = eval(objContainter.attr('data-val-config-keys'));
                    }

                    if ((objContainter) && (arrConfigKeys.length == 3)){
                        if (objContainter.attr('data-val-config-path') == null){
                            alert('The path to the config has not been configured for ' + objContainter.attr('id'));
                        }else{
                            $.when(SHRM.utils.getRemoteData(objContainter.attr('data-val-config-path'))).done(function(response,status,xhrObj){
                                var dataObj = SHRM.utils.convertCSVtoJSON(response, arrConfigKeys)
                                
                                if (objContainter.attr('data-val-filterby') == 'by-1'){
                                    SHRM.utils.configureDropDowns(dataObj, arrConfigKeys[0] + '_keyval', objContainter.find('.selectpicker-1'), SHRM.utils.capitalize(arrConfigKeys[0]))
                                    SHRM.utils.configureDropDowns(dataObj, arrConfigKeys[1] + '_keyval', objContainter.find('.selectpicker-1'), SHRM.utils.capitalize(arrConfigKeys[1]))
                                    SHRM.utils.configureDropDowns(dataObj, arrConfigKeys[2] + '_keyval', objContainter.find('.selectpicker-1'), SHRM.utils.capitalize(arrConfigKeys[2]))
                                }else{
                                    SHRM.utils.configureDropDowns(dataObj, arrConfigKeys[0] + '_keyval', objContainter.find('.selectpicker-1'))
                                    SHRM.utils.configureDropDowns(dataObj, arrConfigKeys[1] + '_keyval', objContainter.find('.selectpicker-2'))
                                    SHRM.utils.configureDropDowns(dataObj, arrConfigKeys[2] + '_keyval', objContainter.find('.selectpicker-3'))
                                }

                            }).fail(function(response,status,xhrObj){
                                console.error(response)
                                console.error('The required config was not found at ' + objContainter.attr('data-val-config-path'))
                            });
                        }
                    }
                    objContainter.attr('loaded', 'true')
                }
            };

            $(document).ready(function() {
                console.time('Page load');

                SHRM.utils.globalConfigKeys = ['region','industry','orgsize']

                $('iframe').on('load', function (event){
                    var iframes = $( event.target ).closest('.tab-pane').find('iframe')
                    var changeDecrease = false;

                    for( var i = 0; i < iframes.length; i++) {
                        if ($(iframes[i])[0].contentDocument.title.indexOf("404") >= 0){
                            console.log("404 Error: Couldn't locate " + $(iframes[i])[0].src)
                            $(iframes[i])[0].src = 'about:blank'
                        }
                        
                        //Find all NA in the iframe and replace it with --
                        //This is being done b/c we didn't know how to remove it within RStudio
                        var iframeDoc = $(iframes[i])[0].contentWindow.document;
                        var vals = $(iframeDoc).find("body").find('td:contains(" NA ")')
                        for( let i = 0, len = vals.length; i < len; i++ ){
                            $(vals[i]).text(' -- ');
                        }
                        //$(iframeDoc).find("body").append('<link rel="preconnect" href="https://fonts.gstatic.com">')
                        //$(iframeDoc).find("body").append('<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&display=swap" rel="stylesheet">')
                        //$(iframeDoc).find("body").css("font-family", "'Montserrat', sans-serif")
                        $(iframeDoc).find("body").css("padding", "15px 50px 1px 20px")
                        
                        //Find all cells without an up/down/flat indicator and add it
                        //This is being done b/c we didn't know how to add it within RStudio
                        var vals = $(iframeDoc).find("body").find('.glyphicon-')
                        for( let i = 0, len = vals.length; i < len; i++ ){
                            amtChange = $(vals[i]).closest('td').prev('td').text();
                            classIndicator = 'glyphicon-arrow-up';
                            $(vals[i]).parent().css('color','silver');
                            if (amtChange.indexOf(' 0%') >= 0){
                                classIndicator = 'glyphicon-minus'
                            }else{
                                if (amtChange.indexOf('-') >= 0) { classIndicator = 'glyphicon-arrow-down' }
                            }
                            $(vals[i]).addClass(classIndicator).removeClass('.glyphicon-')
                        }
                        
                        if ((iframes[i]) && (iframes[i].contentWindow) && (iframes[i].contentWindow.document) && (iframes[i].contentWindow.document.body)){
                            //iframes[i].width  = '100%';
                            iframes[i].height = iframes[i].contentWindow.document.body.scrollHeight + 'px';
                        }
                    }
                });

                $( window ).on('resize', function(event) {
                    //var iframes = $('iframe')
                    var iframes = $('.drilldown').find('.responsive_iframe')
                    
                    for( var i = 0; i < iframes.length; i++) {
                        if ((iframes[i]) && (iframes[i].contentWindow) && (iframes[i].contentWindow.document) && (iframes[i].contentWindow.document.body)){
                            if ((iframes[i].src == '') || (iframes[i].src == 'about:blank')){
                                //iframes[i].width  = '100%';
                                iframes[i].height = '0px';
                            }else{
                                //iframes[i].width  = '100%';
                                iframes[i].height = iframes[i].contentWindow.document.body.scrollHeight + 'px';
                            }
                        }
                    }
                    //console.log('on resize');
                } );

                $('.btn-filter').on('click', function (event){
                    var src = $(event.target).closest('.tab-pane').attr('data-val-file-prefix') + '-'
                    
                    if ($( event.target ).closest('.tab-pane').attr('data-val-filterby') == 'by-1'){
                        //The following code block is here to build the URL Path to match the HTML naming convention ONLY.
                        var arrConfigKeys = SHRM.utils.globalConfigKeys;
                        var optGroup = $( event.target ).closest('.tab-pane').find('.selectpicker-1').find('option:selected').closest('optgroup').attr('label')
                        if ($( event.target ).closest('.tab-pane').attr('data-val-config-keys')){
                            arrConfigKeys = eval($( event.target ).closest('.tab-pane').attr('data-val-config-keys'));
                        }

                        $.each(arrConfigKeys, function( index, value ) {
                            if ((optGroup) && (optGroup.toLowerCase() == value)){
                                src += $(event.target).closest('.tab-pane').find('.selectpicker-1').val();
                            }else{
                                src += '-'
                            }
                        });

                        src += '.html'
                    }else{
                        src = src + $(event.target).closest('.tab-pane').find('.selectpicker-1').val() + '-' + $(event.target).closest('.tab-pane').find('.selectpicker-2').val() + '-' + $(event.target).closest('.tab-pane').find('.selectpicker-3').val() + '.html'
                    }
                    
                    //$(event.target).closest('.tab-pane').find('.responsive_iframe').attr('src', src.toLowerCase())
                    $(event.target).closest('.tab-pane').find('.responsive_iframe').attr('src', src)
                    $(event.target).closest('.tab-pane').find('.btn-export').removeClass('disabled');

                    console.log('on click: ' + src);
                });

                $(document).on('shown.bs.tab', function (event) {
                    var arrHREF = $(event.target).prop('href').split('#')
                    var url = ''
                    if (arrHREF.length == 2){
                        url = arrHREF[1]
                        var obj = $('#' + url)
                    }
                    
                    if ((obj) && (obj.is(':visible'))){
                        //if ($( window ).attr('loaded')){
                        
                        if (SHRM.utils.benefitCategory){
                            obj.find('.selectpicker-1').val(SHRM.utils.benefitCategory)
                            obj.find(".selectpicker-1 option[value='" + SHRM.utils.benefitCategory + "']").prop("selected", true);
                            obj.find('.filter-option-inner-inner').text(obj.find(".selectpicker-1 option[value='" + SHRM.utils.benefitCategory + "']").text())
                        }
                        obj.find('.btn-filter').trigger('click')
                        obj.find('.selectpicker').focus()
                        console.log('shown.bs.tab: ' + obj.is(':visible'))
                        //}
                    }
                });

                $(document).on('show.bs.tab', function (event) {
                    id = $( event.target ).attr('href')
                    initDrillDown($(id));
                });
                
                $('.selectpicker-1').on('change', function (event) {
                    var objContainter = $( event.target ).closest('.tab-pane');
                    var arrConfigKeys = SHRM.utils.globalConfigKeys;
                    
                    if (objContainter.attr('data-val-config-keys')){
                        arrConfigKeys = eval(objContainter.attr('data-val-config-keys'));
                    }

                    if (objContainter.attr('data-val-filterby') == 'by-all'){
                        var ndx = 0;
                        var filterBy = { [arrConfigKeys[ndx]]: [objContainter.find('.selectpicker-1').val()] }  //filterBy = { KEY1: ["VALUE1", "VALUE2"], KEY2: ["VALUE3", "VALUE4"] }
                        SHRM.utils.filterDrillDownSiblings(ndx, filterBy, objContainter, arrConfigKeys);
                    }else{
                        if (objContainter.attr('data-val-filterby') == 'by-3'){
                            SHRM.utils.resetDrillDownSiblings('selectpicker-1', objContainter.find('select'));
                        };
                    }

                    $( event.target ).closest('.tab-pane').find('.btn-export').addClass('disabled')

                    // to auto load the data without having to select the Filter button...
                    // uncomment the lines below and add the 'hidden' to all of the filter buttons
                    
                    SHRM.utils.benefitCategory = $( event.target ).val()
                    $( event.target ).closest('.tab-pane').find('.btn-filter').trigger('click')
                });

                $('.selectpicker-2').on('change', function (event) {
                    var objContainter = $( event.target ).closest('.tab-pane');
                    var arrConfigKeys = SHRM.utils.globalConfigKeys;

                    if (objContainter.attr('data-val-config-keys')){
                        arrConfigKeys = eval(objContainter.attr('data-val-config-keys'));
                    }
                    
                    if (objContainter.attr('data-val-filterby') == 'by-all'){
                        var ndx = 1
                        var filterBy = { [arrConfigKeys[ndx-1]]: [objContainter.find('.selectpicker-1').val()], [arrConfigKeys[ndx]]: [objContainter.find('.selectpicker-2').val()] } //filterBy = { KEY1: ["VALUE1", "VALUE2"], KEY2: ["VALUE3", "VALUE4"] }
                        SHRM.utils.filterDrillDownSiblings(ndx, filterBy, objContainter, arrConfigKeys);
                    }else{
                        if (objContainter.attr('data-val-filterby') == 'by-3'){
                            SHRM.utils.resetDrillDownSiblings('selectpicker-2', objContainter.find('select'));
                        };
                    }
                });

                $('.selectpicker-3').on('change', function (event) {
                    var objContainter = $( event.target ).closest('.tab-pane');
                    
                    if (objContainter.attr('data-val-filterby') == 'by-all'){
                        //console.log('Selected: ' + objContainter.find('select:nth(0)').find('option:selected').val() + ' -- ' + objContainter.find('select:nth(1)').find('option:selected').val() + ' -- ' + objContainter.find('select:nth(2)').find('option:selected').val());
                    }else{
                        if (objContainter.attr('data-val-filterby') == 'by-3'){
                            SHRM.utils.resetDrillDownSiblings('selectpicker-3', objContainter.find('select'));
                        };
                    }
                });
                
                $('.navpicker').on('change', function (event) {
                    $('#' + $( event.target ).val()).trigger('click')
                });

                $('.export_as_csv').on('click', function (event) {
                    var iframes = $( event.target ).closest('.tab-pane').find('iframe')
                    
                    for( var i = 0; i < iframes.length; i++) {
                        if ($(iframes[i])[0].contentDocument.title.indexOf("404") >= 0){
                            console.log("404 Error: Couldn't locate " + $(iframes[i])[0].src)
                            $(iframes[i])[0].src = 'about:blank'
                        }

                        var iframeDoc = $(iframes[i])[0].contentWindow.document;
                        var titles = [];
                        var data = [];

                        //Get the table headers (-- no empty column headers), this will be CSV headers
                        //The count of headers will be CSV string separator
                        $(iframeDoc).find('.table th').each(function() {
                            title = $(this).text().trim()
                            if (title.length > 0) {
                            titles.push(title);
                            }
                        });

                        //Get the actual data, this will contain all the data, in 1 array
                        maxCols = titles.length
                        $(iframeDoc).find('.table tr').each(function(index, obj) {
                            //if (colCount < maxCols) {
                                //data.push($(this).text());
                            //}
                            colCount = 0
                            $( obj ).find('td').each(function(){
                                if (colCount < maxCols) {
                                    content = $(this).text().trim();
                                    data.push(content);
                                }
                                colCount += 1
                            });
                        });

                        //Convert our data to CSV string
                        var CSVString = SHRM.utils.prepHTML2CSV(titles, titles.length, '');
                        CSVString = SHRM.utils.prepHTML2CSV(data, titles.length, CSVString);

                        //Add SHRM Copyright
                        emptyColumns = ',';
                        CSVString += 'Copyright \u00A9 2020 Society for Human Resource Management \u00B7 Source: Employee Benefits 2020' + emptyColumns.repeat(titles.length-1) + '\n'

                        //Make CSV downloadable
                        var downloadLink = document.createElement("a");
                        var blob = new Blob(["\ufeff", CSVString]);
                        var url = URL.createObjectURL(blob);

                        downloadLink.href = url;
                        
                        //Create Name for download file - safe for windows, mac, etc
                        var $tab = $('.nav-tabs'), $active = $tab.find('.nav-link.active'), tab_text = $active.text();
                        var select_text = $( event.target ).closest('.tab-pane').find('.selectpicker-1 option:selected').text();
                        downloadName = 'SHRM Benefits 2020 - ' + tab_text.replace(/[^a-zA-Z0-9-_\.]/g, ' ').trim() + ' - ' + select_text.replace(/[^a-zA-Z0-9-_\.]/g, ' ').trim()
                        downloadName = downloadName.replace('   ', ' ')
                        downloadName = downloadName.replace('  ', ' ')
                        //downloadLink.download = string(downloadName)  //I don't know why this method does not work.
                        downloadLink.download = "data.csv".replace('data', downloadName);

                        //Actually download CSV
                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                        document.body.removeChild(downloadLink);
                    }
                });

                $('.export_as_image').on('click', function (event) {
                    //alert('Coming Soon.');
                    //return;
                    var iframes = $( event.target ).closest('.tab-pane').find('iframe')
                    
                    for( var i = 0; i < iframes.length; i++) {
                        var iframeDoc = $(iframes[i])[0].contentWindow.document;
                        
                        $('.drilldown_image').append(iframeDoc.body.outerHTML).append($('.drilldown_footer')[0].outerHTML);
                        html2canvas(document.querySelector('.drilldown_image')).then(canvas => {
                            console.log(canvas);
                            //saveAs(canvas.toDataURL(), 'file-name.png');

                            //Create Name for download file - safe for windows, mac, etc
                            var $tab = $('.nav-tabs'), $active = $tab.find('.nav-link.active'), tab_text = $active.text();
                            var select_text = $( event.target ).closest('.tab-pane').find('.selectpicker-1 option:selected').text();
                            downloadName = 'SHRM Benefits 2020 - ' + tab_text.replace(/[^a-zA-Z0-9-_\.]/g, ' ').trim() + ' - ' + select_text.replace(/[^a-zA-Z0-9-_\.]/g, ' ').trim()
                            downloadName = downloadName.replace('   ', ' ')
                            downloadName = downloadName.replace('  ', ' ')

                            var link = document.createElement("a");
                            document.body.appendChild(link);
                            link.download = downloadName + '.png'       //link.download = "data.png";
                            link.href = canvas.toDataURL("image/png");
                            link.target = '_blank';
                            link.click();
                            
                            $('.drilldown_image').empty()
                        });
                    }
                });

                $('.export_as_pdf').on('click', function (event) {
                    //alert('Coming Soon.');
                    //return;
                    var iframes = $( event.target ).closest('.tab-pane').find('iframe')
                    
                    for( var i = 0; i < iframes.length; i++) {
                        var iframeDoc = $(iframes[i])[0].contentWindow.document;
                        
                        $('.drilldown_image').append(iframeDoc.body.outerHTML).append($('.drilldown_footer')[0].outerHTML);
                        html2canvas(document.querySelector('.drilldown_image')).then(canvas => {
                            console.log(canvas);
                            //saveAs(canvas.toDataURL(), 'file-name.png');

                            //Create Name for download file - safe for windows, mac, etc
                            var $tab = $('.nav-tabs'), $active = $tab.find('.nav-link.active'), tab_text = $active.text();
                            var select_text = $( event.target ).closest('.tab-pane').find('.selectpicker-1 option:selected').text();
                            downloadName = 'SHRM Benefits 2020 - ' + tab_text.replace(/[^a-zA-Z0-9-_\.]/g, ' ').trim() + ' - ' + select_text.replace(/[^a-zA-Z0-9-_\.]/g, ' ').trim()
                            downloadName = downloadName.replace('   ', ' ')
                            downloadName = downloadName.replace('  ', ' ')

                            var imgData = canvas.toDataURL('image/jpeg');  
                            var doc = new jsPDF('l', 'mm');
                            doc.addImage(imgData, 'JPG', 10, 10);
                            doc.save(downloadName + '.pdf');
                            
                            $('.drilldown_image').empty()
                        });
                    }
                });

                initDrillDown($('#drilldown-tab1'));
                
                console.timeEnd('Page load');
            });
        </script>

        <style>
            body {
                font-family: 'Montserrat', sans-serif;
                font-weight: 400;
            }

            .table {
                padding: 5px !important;
                line-height: 1.42857143 !important;
                vertical-align: top !important;
                border-top: 1px solid #ddd !important;
                font-family: "Helvetica Neue",Helvetica,Arial,sans-serif !important;
                font-size: 14px !important;
                
            }

            .table>thead>tr>th {
                font-weight: bold !important;
                padding: 5px !important;
            }

            .table>tbody>tr>td {
                padding: 5px !important;
            }

            .dropdown-item {
                font-weight: 500;
            }

            div.drilldown {
                background-color:white;
                margin-left: 20px;
            }

            .hidden {
                display: none;
            }

            div.responsive_container {
                position: absolute;
                overflow: hidden;
                display: block;
                width: 100%;
                height: 100%;
            }

            span.drilldown_footer {
                font-family: Roboto, sans-serif;
                font-weight: 400;
                font-size: 11px;
                text-decoration: none;
                color: #888;
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: center;
                padding-left:25px;
                width: 100%;
            }

            a.nav-link {color: #333333;}

            .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {color: #000000; font-weight: 500;}

            @media screen and (max-width: 1275px) {
                .nav_layer1{ display: contents; }
                .nav_layer2{ display: none; }
            }

            @media screen and (min-width: 1275px) {
                .nav_layer1{ display: none; }
                .nav_layer2{ display: block; }
            }

            iframe.responsive_iframe {
                position: relative;
                width: 100%;
                min-width: 600px;
                min-height: 200px;
            }
            
            .bootstrap-select>.dropdown-toggle.bs-placeholder, .bootstrap-select>.dropdown-toggle.bs-placeholder:active, .bootstrap-select>.dropdown-toggle.bs-placeholder:focus, .bootstrap-select>.dropdown-toggle.bs-placeholder:hover {
                ocolor: #000;
            }

            @media not all and (min-resolution:.001dpcm) { 
                @supports (-webkit-appearance:none) {
                    .bootstrap-select {
                        height: 35px;
                    }
                }
            }

            
        </style>
        
    </head>

    <body ostyle="max-width:1275px">
        <div class="drilldown" id="drilldown_benefits_2020">
            <div class="tab-content" oid="tabs_Content">
                <div class="nav_layer2">
                    <ul class="nav nav-tabs" id="tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="drilldown-one-tab" data-toggle="tab" href="#drilldown-tab1" role="tab" aria-controls="home" aria-selected="true">General Health</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="drilldown-two-tab" data-toggle="tab" href="#drilldown-tab2" role="tab" aria-controls="home" aria-selected="true">HSA & FSA</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="drilldown-three-tab" data-toggle="tab" href="#drilldown-tab3" role="tab" aria-controls="home" aria-selected="true">Prescription Drug</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="drilldown-four-tab" data-toggle="tab" href="#drilldown-tab4" role="tab" aria-controls="home" aria-selected="true">Supplemental Health Ins.</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="drilldown-five-tab" data-toggle="tab" href="#drilldown-tab5" role="tab" aria-controls="home" aria-selected="true">Disability & Accident Ins.</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="drilldown-six-tab" data-toggle="tab" href="#drilldown-tab6" role="tab" aria-controls="home" aria-selected="true">Coverage for Specific Health Services</a>
                        </li>
                    </ul>
                </div>
                <div class="nav_layer1">
                    <select class="col-md-4 selectpicker navpicker" data-size="9">
                        <option value="drilldown-one-tab">General Health</option>
                        <option value="drilldown-two-tab">HSA & FSA</option>
                        <option value="drilldown-three-tab">Prescription Drug</option>
                        <option value="drilldown-four-tab">Supplemental Health Ins.</option>
                        <option value="drilldown-five-tab">Disability & Accident Ins.</option>
                        <option value="drilldown-six-tab">Coverage for Specific Health Services</option>
                    </select>
                </div>
                <div class="tab-pane fade show active" id="drilldown-tab1" role="tabpanel" aria-labelledby="drilldown-tab1" data-val-filterby="by-1" data-val-file-prefix='./data/Health/GenHealth' data-val-config-keys="['region','industry','orgsize']" data-val-config-path="./data/config.csv">
                    <div>
                        <select class="col-md-4 selectpicker selectpicker-1" data-size="9" style="height: 35px">
                            <option value="" data-val="all">All (Regions, Industries and Org Sizes)</option>
                        </select>
                        <!--
                        <span class="ors"> OR </span>
                        <select required="required" class="col-md-2 selectpicker selectpicker-2" data-size="6">
                            <option value="" data-val="all">All Industries</option>
                        </select>
                        <span class="ors"> OR </span>
                        <select required="required" class="col-md-2 selectpicker selectpicker-3" data-size="6">
                            <option value="" data-val="all">All Orgs</option>
                        </select>
                        -->
                        <div class="col-md-3" style="display:inline-block">
                            <button type="button" class="btn btn-primary btn-sm btn-filter hidden"><span class="fas fa-filter" aria-hidden="true"></span> Filter </button>
                            <div class="btn-group" role="group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm btn-export" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Export
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item export_as_csv" href="#">as CSV</a>
                                    <a class="dropdown-item export_as_image" href="#">as Image</a>
                                    <a class="dropdown-item export_as_pdf" href="#">as PDF</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <iframe class="responsive_iframe" src="data/Health/GenHealth----.html" allowtransparency="true" frameborder="0" onerror=="alert('error')"></iframe>
                    </div>
                </div>
                <div class="tab-pane fade" id="drilldown-tab2" role="tabpanel" aria-labelledby="drilldown-tab2" data-val-filterby="by-1" data-val-file-prefix='./data/Health/HealthSavings' data-val-config-keys="['region','industry','orgsize']" data-val-config-path="./data/config.csv">
                    <div>
                        <select class="col-md-4 selectpicker selectpicker-1" data-size="9">
                            <option value="" data-val="all">All (Regions, Industries and Org Sizes)</option>
                        </select>
                        <div class="col-md-3" style="display:inline-block">
                            <button type="button" class="btn btn-primary btn-sm btn-filter hidden"><span class="fas fa-filter" aria-hidden="true"></span> Filter </button>
                            <div class="btn-group" role="group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm btn-export" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Export
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item export_as_csv" href="#">as CSV</a>
                                    <a class="dropdown-item export_as_image" href="#">as Image</a>
                                    <a class="dropdown-item export_as_pdf" href="#">as PDF</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <iframe class="responsive_iframe" src="about:blank" allowtransparency="true" frameborder="0" onerror=="alert('error')"></iframe>
                    </div>
                </div>
                <div class="tab-pane fade" id="drilldown-tab3" role="tabpanel" aria-labelledby="drilldown-tab3" data-val-filterby="by-1" data-val-file-prefix='./data/Health/PrescriptionDrugs' data-val-config-keys="['region','industry','orgsize']" data-val-config-path="./data/config.csv">
                    <div>
                        <select class="col-md-4 selectpicker selectpicker-1" data-size="9">
                            <option value="" data-val="all">All (Regions, Industries and Org Sizes)</option>
                        </select>
                        <div class="col-md-3" style="display:inline-block">
                            <button type="button" class="btn btn-primary btn-sm btn-filter hidden"><span class="fas fa-filter" aria-hidden="true"></span> Filter </button>
                            <div class="btn-group" role="group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm btn-export" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Export
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item export_as_csv" href="#">as CSV</a>
                                    <a class="dropdown-item export_as_image" href="#">as Image</a>
                                    <a class="dropdown-item export_as_pdf" href="#">as PDF</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <iframe class="responsive_iframe" src="about:blank" allowtransparency="true" frameborder="0" onerror=="alert('error')"></iframe>
                    </div>
                </div>
                <div class="tab-pane fade" id="drilldown-tab4" role="tabpanel" aria-labelledby="drilldown-tab4" data-val-filterby="by-1" data-val-file-prefix='./data/Health/Dental_Vision' data-val-config-keys="['region','industry','orgsize']" data-val-config-path="./data/config.csv">
                    <div>
                        <select class="col-md-4 selectpicker selectpicker-1" data-size="9">
                            <option value="" data-val="all">All (Regions, Industries and Org Sizes)</option>
                        </select>
                        <div class="col-md-3" style="display:inline-block">
                            <button type="button" class="btn btn-primary btn-sm btn-filter hidden"><span class="fas fa-filter" aria-hidden="true"></span> Filter </button>
                            <div class="btn-group" role="group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm btn-export" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Export
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item export_as_csv" href="#">as CSV</a>
                                    <a class="dropdown-item export_as_image" href="#">as Image</a>
                                    <a class="dropdown-item export_as_pdf" href="#">as PDF</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <iframe class="responsive_iframe" src="about:blank" allowtransparency="true" frameborder="0" onerror=="alert('error')"></iframe>
                    </div>
                </div>
                <div class="tab-pane fade" id="drilldown-tab5" role="tabpanel" aria-labelledby="drilldown-tab5" data-val-filterby="by-1" data-val-file-prefix='./data/Health/DisabilityAccident' data-val-config-keys="['region','industry','orgsize']" data-val-config-path="./data/config.csv">
                    <div>
                        <select class="col-md-4 selectpicker selectpicker-1" data-size="9">
                            <option value="" data-val="all">All (Regions, Industries and Org Sizes)</option>
                        </select>
                        <div class="col-md-3" style="display:inline-block">
                            <button type="button" class="btn btn-primary btn-sm btn-filter hidden"><span class="fas fa-filter" aria-hidden="true"></span> Filter </button>
                            <div class="btn-group" role="group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm btn-export" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Export
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item export_as_csv" href="#">as CSV</a>
                                    <a class="dropdown-item export_as_image" href="#">as Image</a>
                                    <a class="dropdown-item export_as_pdf" href="#">as PDF</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <iframe class="responsive_iframe" src="about:blank" allowtransparency="true" frameborder="0" onerror=="alert('error')"></iframe>
                    </div>
                </div>
                <div class="tab-pane fade" id="drilldown-tab6" role="tabpanel" aria-labelledby="drilldown-tab6" data-val-filterby="by-1" data-val-file-prefix='./data/Health/Specific_Services' data-val-config-keys="['region','industry','orgsize']" data-val-config-path="./data/config.csv">
                    <div>
                        <select class="col-md-4 selectpicker selectpicker-1" data-size="9">
                            <option value="" data-val="all">All (Regions, Industries and Org Sizes)</option>
                        </select>
                        <div class="col-md-3" style="display:inline-block">
                            <button type="button" class="btn btn-primary btn-sm btn-filter hidden"><span class="fas fa-filter" aria-hidden="true"></span> Filter </button>
                            <div class="btn-group" role="group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-sm btn-export" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Export
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item export_as_csv" href="#">as CSV</a>
                                    <a class="dropdown-item export_as_image" href="#">as Image</a>
                                    <a class="dropdown-item export_as_pdf" href="#">as PDF</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <iframe class="responsive_iframe" src="about:blank" allowtransparency="true" frameborder="0" onerror=="alert('error')"></iframe>
                    </div>
                </div>
            </div>
            <span class="drilldown_footer">Chart: &#169; 2020 Society for Human Resource Management &middot; Source: Employee Benefits 2020</span>
        </div>
        <div class='drilldown_image' ostyle="max-width: 1000px" style="max-width: 1000px;z-index:-1000;top:0px;left:-25999px;position:absolute"></div>
    </body>
</html>